{% extends 'chanppEvImBundle::layout.html.twig' %}
{% block title %}Editar Ficha de Programa {{ entity.nombre }}{% endblock %}
{% block body -%}
    <div id="breadcrumb-bar">
        <div class="breadcrumb-text">
            <a href="{{ path('fichaproyecto_show', { 'id':entity.id }) }}">Ficha de Programa "{{ entity.nombre }}"</a>
            <img  src="{{ asset('img/sidearrow.png') }}" alt="logo"/>
            Editando Ficha de Programa
        </div>
    </div>
    {% include 'navbar.html.twig' %}
    
    <div id="main-content">
        <div class="main-content-title">
            <div class="title-text">
                <h2>Editar Ficha de Programa</h2>
            </div>
            <a href="#" class="htooltip"><img id="icon-help" src="{{ asset('img/icono-ayuda.png') }}" alt="logo"/><span>help text</span></a>

            {% if (is_granted("ROLE_ADMIN") or is_granted("ROLE_SUPER_ADMIN")) %}

                <div class="title-actions">
                    <div class="btn-group">
                        <button class="btn">Elegir una Acción</button>
                        <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <!-- dropdown menu links -->
                            <li>
                                <form class="dropdown-menu-form" id="delete-form" action="{{ path('fichaproyecto_delete', { 'id': entity.id }) }}" method="post">
                                    <input type="hidden" name="_method" value="DELETE" />
                                        {{ form_widget(delete_form) }}
                                    <a class="dropdown-menu-link" type="submit" style="border: 0; background: transparent" onclick="confirmDelete()">Borrar Ficha<br />de Programa</a>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>

            {% endif %}
        </div>

        <br />
        <br />

        <div class="form-content">
            <form action="{{ path('fichaproyecto_update', { 'id': entity.id }) }}" method="post" {{ form_enctype(edit_form) }}>
                <input type="hidden" name="_method" value="PUT" />

                <div class="row-fluid">
                    <div class="span6">
                        {{ form_row(edit_form.area_accion) }}
                        {{ form_row(edit_form.linea_accion) }}
                        {{ form_row(edit_form.nombre) }}
                        {{ form_row(edit_form.jefe) }}
                    </div>
                        
                    <div class="span6">
                        {{ form_row(edit_form.duracion) }}   
                        {{ form_row(edit_form.diagnostico_previo) }}
                        {{ form_row(edit_form.obj_general) }}
                        {{ form_row(edit_form.objs_especificos) }}                     
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span12">
                        {{ form_row(edit_form.descripcion) }}
                    </div>
                </div>
                
                <div class="row-fluid">
                    <div class="span12">
                        {{ form_row(edit_form.resumen_descripcion) }}
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span6">
                        {{ form_row(edit_form.desc_causales) }}
                    </div>
                        
                    <div class="span6">
                        {{ form_row(edit_form.variables_causales) }}                    
                    </div>
                </div>
                        

                <br />
                <br />

                <div class="title-text">
                    <h3>Actividades</h3>
                </div>
                <a href="#" class="htooltip"><img id="icon-help" src="{{ asset('img/icono-ayuda.png') }}" alt="logo"/><span>help text</span></a>

                {% if (is_granted("ROLE_ADMIN") or is_granted("ROLE_SUPER_ADMIN") or is_granted("ROLE_PLANIFICADOR")) %}

                    <div class="title-actions">
                        <div class="btn-group">
                            <button class="btn">Elegir una Acción</button>
                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <!-- dropdown menu links -->
                                <li>
                                    <a href="#" id="agregar_actividad">Agregar una actividad</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                {% endif %}

                <br />
                <br />
                <br />

                <div class="chanpp_evimbundle_fichaproyectotype_activities" id="chanpp_evimbundle_fichaproyectotype_activities" data-prototype="{{ form_widget(edit_form.activities.vars.prototype)|e }}">
                
                    {% for activity in edit_form.activities %}

                        <div class="row-fluid">
                            <div class="span12">
                                {{ form_row(activity.nombre) }}
                                {{ form_row(activity.descripcion) }}
                                {{ form_row(activity.resultadosEsperados) }}
                                {{ form_row(activity.duracion) }}
                            </div>

                            <a href="" class="btn btn-danger" id="boton_borrar">Borrar esta actividad</a>
                            
                            <br />
                            <br />
                        
                        </div>

                    {% endfor %}
                </div>

                <br/> <br />

                {{ form_rest(edit_form) }}   

                {% if entity.getIndGestions|length>0 %}

                    <div class="title-text">
                        <h3>Indicadores de gestión</h3>
                    </div>
                    <a href="#" class="htooltip"><img id="icon-help" src="{{ asset('img/icono-ayuda.png') }}" alt="logo"/><span>help text</span></a>

                    {% if (is_granted("ROLE_ADMIN") or is_granted("ROLE_SUPER_ADMIN") or is_granted("ROLE_PLANIFICADOR")) %}

                        <div class="title-actions">
                            <div class="btn-group">
                                <button class="btn">Elegir una Acción</button>
                                <button class="btn dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <!-- dropdown menu links -->
                                    <li>
                                        <a href="{{ path('indgestion_new',{ 'ficha_proyecto_id': entity.id }) }}">Agregar Indicador<br />de gestión</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                    {% endif %}
                
                    <table class="table table-striped table-bordered table-condensed table-striped tablesubelements fixed tablesorter">
                        <thead>
                            <tr class="tableinfohead">
                                <th style="width: 90%;">Nombre</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                {% for ind in entity.getIndGestions %}
                                    <tr>
                                        <td>{{ind.getNombre}}</td>
                                        <td>
                                            {% if (is_granted("ROLE_ADMIN") or is_granted("ROLE_SUPER_ADMIN") or is_granted("ROLE_PLANIFICADOR")) %}
                                                <a href="{{ path('indgestion_edit',{'id' : ind.getId}) }}"><img class="icon-action-table2" src="{{ asset('img/icono-editar-(lapiz).png') }}" alt="logo"/></a>

                                                <a href="{{ path('indgestion_delete',{'id' : ind.getId}) }}"><img class="icon-action-table2" src="{{ asset('img/icono-eliminar-(cruz).png') }}" alt="logo"/></a>
                                                
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
            </form>

            <br />
            <br />
            <button type="submit" class="btn btn-primary">Guardar Ficha de Programa</button>

        </div>    

    </div>

    {% block javascript %}

        <script type="text/javascript">
            var collectionHolder = $('div#chanpp_evimbundle_fichaproyectotype_activities');
            var indexNo = 4;
            var $newFormDiv = $("<div id=borrar_actividad></div>");
            var $removeFormA = $('<a href="#" class="btn btn-danger">Borrar esta actividad</a><br /> <br/>');
        </script>

        <script type="text/javascript">
            function confirmDelete() {
                if(confirm('¿Seguro que desea eliminar?'))
                {
                    document.getElementById('delete-form').submit();
                }
            }
        </script>
    
        {% javascripts 
            '@chanppEvImBundle/Resources/public/js/addActividades.js'
            '@chanppEvImBundle/Resources/public/js/borrar_actividades.js'
        %}
        
            <script src="{{ asset_url }}"></script>
    
        {% endjavascripts %}
    {% endblock %}

{% endblock %}




